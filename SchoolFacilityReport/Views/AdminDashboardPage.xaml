<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SchoolFacilityReport.ViewModels"
             x:Class="SchoolFacilityReport.Views.AdminDashboardPage"
             Title="Admin Dashboard"
             BackgroundColor="{StaticResource PageBackground}"
             Shell.NavBarIsVisible="False">

    <!-- BindingContext is set in CodeBehind via Dependency Injection -->

    <Grid RowDefinitions="Auto, *">
        <!-- Header -->
        <Border Grid.Row="0" 
                BackgroundColor="White" 
                StrokeThickness="0" 
                Padding="20,50,20,20"
                Shadow="{StaticResource Shadow}">
            <Grid ColumnDefinitions="Auto, *, Auto">
                 <ImageButton Grid.Column="0" 
                             Source="{FontImage Glyph='❮', Color={StaticResource TextPrimary}, Size=20}"
                             Command="{Binding LogoutCommand}"
                             HorizontalOptions="Start"/>

                <Label Grid.Column="1" 
                       Text="Report List" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       VerticalOptions="Center"
                       TextColor="{StaticResource TextPrimary}"/>
                
                <ImageButton Grid.Column="2" 
                             Source="{FontImage Glyph='🔄', Color={StaticResource Primary}, Size=22}"
                             Command="{Binding LoadReportsCommand}"
                             HorizontalOptions="End"/>
            </Grid>
        </Border>

        <!-- Content -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding LoadReportsCommand}" 
                     IsRefreshing="{Binding IsBusy}"
                     Padding="20">
            <CollectionView ItemsSource="{Binding Reports}" 
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding SelectReportCommand}"
                            SelectionChangedCommandParameter="{Binding Path=SelectedItem, Source={RelativeSource Self}}">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
                </CollectionView.ItemsLayout>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeThickness="0" 
                                StrokeShape="RoundRectangle 16"
                                BackgroundColor="White"
                                Padding="15">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,4" Radius="10" Opacity="0.05"/>
                            </Border.Shadow>
                            
                            <Grid ColumnDefinitions="80, *" ColumnSpacing="15">
                                <!-- Image Thumbnail -->
                                <Border Grid.Column="0" 
                                        HeightRequest="80" 
                                        WidthRequest="80" 
                                        StrokeShape="RoundRectangle 12" 
                                        StrokeThickness="0"
                                        BackgroundColor="{StaticResource SurfaceAlt}">
                                    <Image Source="{Binding ImagePath}" Aspect="AspectFill"/>
                                </Border>
                                
                                <!-- Info -->
                                <VerticalStackLayout Grid.Column="1" Spacing="6" VerticalOptions="Center">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <Label Grid.Column="0" 
                                               Text="{Binding Category}" 
                                               FontSize="16" 
                                               FontAttributes="Bold" 
                                               TextColor="{StaticResource TextPrimary}"/>
                                        
                                        <!-- Urgency Dot -->
                                        <BoxView Grid.Column="1" 
                                                 Color="{Binding UrgencyColor}" 
                                                 HeightRequest="10" 
                                                 WidthRequest="10" 
                                                 CornerRadius="5"
                                                 VerticalOptions="Center"/>
                                    </Grid>
                                    
                                    <Label Text="{Binding Description}" 
                                           MaxLines="2" 
                                           LineBreakMode="TailTruncation" 
                                           TextColor="{StaticResource TextSecondary}" 
                                           FontSize="13"/>
                                           
                                    <Grid ColumnDefinitions="*, Auto" Margin="0,5,0,0">
                                        <Label Grid.Column="0" 
                                               Text="{Binding CreatedAt, StringFormat='{0:MMM dd}'}" 
                                               TextColor="{StaticResource Gray400}" 
                                               FontSize="12"/>
                                        
                                        <!-- Status Pill -->
                                        <Border Grid.Column="1" 
                                                StrokeThickness="0" 
                                                BackgroundColor="{Binding StatusColor}"
                                                StrokeShape="RoundRectangle 8"
                                                Padding="8,2">
                                            <Label Text="{Binding Status}" 
                                                   TextColor="White" 
                                                   FontSize="11" 
                                                   FontAttributes="Bold"/>
                                        </Border>
                                    </Grid>
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout Spacing="10" VerticalOptions="Center" HorizontalOptions="Center" Margin="0,100,0,0">
                        <Label Text="📝" FontSize="48" HorizontalOptions="Center"/>
                        <Label Text="No reports found" 
                               TextColor="{StaticResource TextSecondary}" 
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>