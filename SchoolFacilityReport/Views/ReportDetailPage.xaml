<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SchoolFacilityReport.ViewModels"
             xmlns:strings="clr-namespace:SchoolFacilityReport.Resources.Strings"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="SchoolFacilityReport.Views.ReportDetailPage"
             Title="{x:Static strings:AppResources.PageTitle_JobDetails}"
             BackgroundColor="#F5F5F5">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">

            <Frame CornerRadius="20" HasShadow="True" Padding="0" BackgroundColor="White" BorderColor="Transparent">
                <VerticalStackLayout Spacing="0">

                    <Image Source="{Binding Report.ImageUrl}" 
                           HeightRequest="250" 
                           Aspect="AspectFill"
                           BackgroundColor="#EEE"
                           IsVisible="{Binding Report.ImageUrl, Converter={toolkit:IsNotNullConverter}}"/>

                    <VerticalStackLayout Padding="20" Spacing="10">

                        <Label Text="{Binding Report.Category, Converter={StaticResource CategoryLocConverter}}" 
                               FontSize="24" FontAttributes="Bold" TextColor="#333"/>

                        <HorizontalStackLayout Spacing="5">
                            <Label Text="📅" FontSize="12"/>
                            <Label Text="{Binding Report.CreatedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}" 
                                   TextColor="#888" FontSize="12"/>
                        </HorizontalStackLayout>

                        <BoxView HeightRequest="1" Color="#F0F0F0" Margin="0,5"/>

                        <Label Text="{x:Static strings:AppResources.DescLabel}" 
                               FontSize="12" FontAttributes="Bold" TextColor="#512BD4"/>

                        <Border StrokeThickness="0" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 10" Padding="15">
                            <Label Text="{Binding Report.Description}" FontSize="15" TextColor="#444"/>
                        </Border>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <Label Text="ADMIN ACTIONS" FontSize="12" FontAttributes="Bold" TextColor="#999" Margin="5,10,0,0"/>

            <VerticalStackLayout Spacing="15">

                <VerticalStackLayout Spacing="5">
                    <Label Text="{x:Static strings:AppResources.StatusUpdateTitle}" FontAttributes="Bold" TextColor="#444"/>

                    <Border Stroke="#E0E0E0" StrokeThickness="1" StrokeShape="RoundRectangle 10" BackgroundColor="White" Padding="15,12">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding OpenStatusPopupCommand}"/>
                        </Border.GestureRecognizers>

                        <Grid ColumnDefinitions="*, Auto">
                            <Label Grid.Column="0" 
                                   Text="{Binding SelectedStatus, Converter={StaticResource StatusLocConverter}}" 
                                   TextColor="#333" FontSize="16" VerticalOptions="Center"/>

                            <Label Grid.Column="1" Text="▼" TextColor="#999" FontSize="12" VerticalOptions="Center"/>
                        </Grid>
                    </Border>
                </VerticalStackLayout>
                <VerticalStackLayout Spacing="5">
                    <Label Text="{x:Static strings:AppResources.AdminNotesTitle}" FontAttributes="Bold" TextColor="#444"/>
                    <Border Stroke="#E0E0E0" StrokeThickness="1" StrokeShape="RoundRectangle 10" BackgroundColor="White" Padding="15,5">
                        <Editor Text="{Binding AdminNotes}" 
                                Placeholder="Enter notes here..." 
                                HeightRequest="100" 
                                TextColor="#333"
                                PlaceholderColor="#999"
                                AutoSize="TextChanges"/>
                    </Border>
                </VerticalStackLayout>

            </VerticalStackLayout>

            <Border StrokeThickness="0" StrokeShape="RoundRectangle 25" HeightRequest="55" Margin="0,10,0,20">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#4A00E0" Offset="0.0" />
                        <GradientStop Color="#8E2DE2" Offset="1.0" />
                    </LinearGradientBrush>
                </Border.Background>
                <Border.Shadow>
                    <Shadow Brush="#8E2DE2" Offset="0,5" Radius="10" Opacity="0.4"/>
                </Border.Shadow>

                <Grid>
                    <Label Text="{x:Static strings:AppResources.SaveBtn}" 
                           TextColor="White" FontAttributes="Bold" FontSize="18" 
                           HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Button BackgroundColor="Transparent" Command="{Binding UpdateReportCommand}"/>
                </Grid>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>