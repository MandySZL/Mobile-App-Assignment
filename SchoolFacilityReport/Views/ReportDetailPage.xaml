<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SchoolFacilityReport.ViewModels"
             x:Class="SchoolFacilityReport.Views.ReportDetailPage"
             Title="Details"
             BackgroundColor="{StaticResource PageBackground}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto, *">
        <!-- Header -->
        <Border Grid.Row="0" 
                BackgroundColor="White" 
                StrokeThickness="0" 
                Padding="20,50,20,20"
                Shadow="{StaticResource Shadow}">
            <Grid ColumnDefinitions="Auto, *, Auto">
                <ImageButton Grid.Column="0" 
                             Source="{FontImage Glyph='❮', Color={StaticResource TextPrimary}, Size=20}"
                             Command="{Binding BackCommand}"
                             HorizontalOptions="Start"/>
                
                <Label Grid.Column="1" 
                       Text="Details" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       VerticalOptions="Center"
                       TextColor="{StaticResource TextPrimary}"/>
            </Grid>
        </Border>

        <ScrollView Grid.Row="1" Padding="20">
            <VerticalStackLayout Spacing="20">
                
                <!-- Main Info Card -->
                <Border StrokeThickness="0" 
                        StrokeShape="RoundRectangle 20" 
                        BackgroundColor="White"
                        Padding="0">
                    <Border.Shadow>
                        <Shadow Brush="Black" Offset="0,4" Radius="15" Opacity="0.05"/>
                    </Border.Shadow>
                    
                    <VerticalStackLayout Spacing="0">
                        <!-- Image Header -->
                        <Grid HeightRequest="250" BackgroundColor="{StaticResource SurfaceAlt}">
                            <Image Source="{Binding Report.ImagePath}" Aspect="AspectFill"/>
                            <Label Text="No Image" 
                                   IsVisible="{Binding Report.ImagePath, Converter={x:StaticResource InvertedBoolConverter}}" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center"
                                   TextColor="{StaticResource TextSecondary}"/>
                        </Grid>
                        
                        <!-- Content -->
                        <VerticalStackLayout Padding="20" Spacing="15">
                            <Grid ColumnDefinitions="*, Auto">
                                <Label Grid.Column="0" 
                                       Text="{Binding Report.Category}" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="{StaticResource TextPrimary}"/>
                                <Label Grid.Column="1" 
                                       Text="{Binding Report.CreatedAt, StringFormat='{0:MMM dd}'}" 
                                       TextColor="{StaticResource TextSecondary}" 
                                       VerticalOptions="Center"/>
                            </Grid>
                            
                            <BoxView HeightRequest="1" Color="{StaticResource Gray100}"/>
                            
                            <Label Text="DESCRIPTION" FontSize="12" FontAttributes="Bold" TextColor="{StaticResource TextSecondary}"/>
                            <Label Text="{Binding Report.Description}" 
                                   FontSize="15" 
                                   TextColor="{StaticResource TextPrimary}" 
                                   LineHeight="1.2"/>
                                   
                            <BoxView HeightRequest="1" Color="{StaticResource Gray100}"/>
                            
                            <Grid ColumnDefinitions="*,*">
                                <VerticalStackLayout Grid.Column="0" Spacing="5">
                                    <Label Text="STATUS" FontSize="12" FontAttributes="Bold" TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding Report.Status}" 
                                           TextColor="{Binding Report.StatusColor}" 
                                           FontAttributes="Bold"
                                           FontSize="16"/>
                                </VerticalStackLayout>
                                
                                <VerticalStackLayout Grid.Column="1" Spacing="5">
                                    <Label Text="URGENCY" FontSize="12" FontAttributes="Bold" TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding Report.Urgency}" 
                                           TextColor="{Binding Report.UrgencyColor}" 
                                           FontAttributes="Bold"
                                           FontSize="16"/>
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Admin Action Section -->
                <VerticalStackLayout IsVisible="{Binding IsAdmin}" Spacing="15">
                    <Label Text="Admin Actions" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,10,0,0"/>

                    <Border StrokeThickness="0" 
                            StrokeShape="RoundRectangle 20" 
                            BackgroundColor="White"
                            Padding="20">
                        <Border.Shadow>
                            <Shadow Brush="Black" Offset="0,4" Radius="15" Opacity="0.05"/>
                        </Border.Shadow>
                        
                        <VerticalStackLayout Spacing="15">
                            <Label Text="Change Status" TextColor="{StaticResource TextSecondary}" FontSize="14" FontAttributes="Bold"/>
                            
                            <Button Text="{Binding Report.Status, StringFormat='Target Status: {0}'}" 
                                    Command="{Binding ChangeStatusCommand}" 
                                    BackgroundColor="{StaticResource SurfaceAlt}" 
                                    TextColor="{StaticResource TextPrimary}"
                                    BorderWidth="1"
                                    BorderColor="{StaticResource Gray200}"/>

                            <Label Text="Admin Notes" TextColor="{StaticResource TextSecondary}" FontSize="14" FontAttributes="Bold" Margin="0,10,0,0"/>
                            <Editor Text="{Binding AdminNote}" 
                                    Placeholder="Add notes..." 
                                    HeightRequest="100" 
                                    BackgroundColor="{StaticResource SurfaceAlt}"
                                    TextColor="{StaticResource TextPrimary}"/>
                                    
                            <Button Text="Save Review" 
                                    Command="{Binding SaveReviewCommand}" 
                                    Margin="0,10,0,0"
                                    Style="{StaticResource Button}"/>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>